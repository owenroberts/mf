!function(){"use strict";function t(t,e,n){const o=[];let a,s,i,r=0,c=2,d=!1,l="start",m={cat:t,dog:e};const u={};let p;w();let h=new CFGGenerator({tagChance:1,filterChance:1});function w(){l="start";const[t,e]=Cool.shuffle(["cat","dog"]);a=m[t],o.push({speaker:t,text:"I'm hungry."}),o.push({speaker:e,text:"Me too."}),o.push({speaker:t,text:"When will we eat again?"}),o.push({speaker:e,text:"I don't know."}),o.push({speaker:t,text:"Should we watch some tv?"})}return async function(){const t=await fetch("./text_tools/data/FEAR_AND_TREMBLING-cfg.json").then((t=>t.json()));h.feed("cat",t),h.feed("dog",t)}(),{update:function(t){if(r<=c)return r+=t/1e3;if(!s&&0===o.length){if("start"===l)return s=!1,function(){l="new";const[t,e]=Cool.shuffle(["cat","dog"]);a=m[t],o.push({speaker:t,text:"What was the point of that?"}),o.push({speaker:e,text:h.getText(e,"C",{C:[["I think it was about","DT","NN","of","NN","."]]}).text}),o.push({speaker:t,text:h.getText(t,"C",{C:[["You don't think it was","Q"]]}).text}),o.push({speaker:e,text:h.getText(e,"C",{C:[["I guess it might have been","S"]]}).text}),o.push({speaker:t,text:h.getText(t,"C",{C:[["I don't think we really know what it was about."]]}).text})}(),d=!1,!0;"new"===l&&(s=!1,w())}if(!s){const t=o.shift();if(i=Cool.randomInt(e||1,f||2),s=t.speaker,a=m[t.speaker],a.isActive=!0,a.setMsg(t.text),n(s,!0),p&&u[t.speaker]){const e=new SpeechSynthesisUtterance(t.text);e.rate=.75,e.voice=u[t.speaker],p.speak(e)}}var e,f;const g=a.display();if(!g)return!1;g&&(c=i,r=0,a.isActive=!1,n(Cool.random(["cat","dog","tv","main"]),!1),s=!1)},setupVoice:function(){window.speechSynthesis&&(p=window.speechSynthesis,p.onvoiceschanged=function(){const t=p.getVoices(),e=t.find((t=>"Fred"===t.name)),n=t.find((t=>"Victoria"===t.name));u.cat=n||t[1],u.dog=e||t[0]})},isActive:()=>d,start(){d=!0}}}const{Game:e,Sprite:n,TextButton:o,TextSprite:a}=LinesEngine,s=new e({dps:20,width:960,height:720,retina:!0,debug:!0,stats:!0,suspend:!1,scenes:["loading","main","cat","dog","tv","start"],lineWidth:1,events:["mouse"]});let i,r,c,d,l,m,u,p,h,w;s.load({sprites:"public/sprites.json"});let f=!1,g=function(){let t=!1;const e=document.getElementById("three"),n=new THREE.WebGLRenderer({canvas:e,antialias:!0});n.setSize(960,720),document.body.appendChild(n.domElement);const o=new THREE.Scene,a=new THREE.PerspectiveCamera(75,960/720,.1,1e3);a.position.z=7;const s=new THREE.AmbientLight(3026478,1);o.add(s);const i=new THREE.PointLight(16777215,1);i.position.set(0,0,-10),o.add(i);const r=new THREE.PointLight(16777215,.75);r.position.set(0,0,10),o.add(r);const c=new THREE.EffectComposer(n);c.addPass(new THREE.RenderPass(o,a));new THREE.ShaderPass(THREE.DotScreenShader).uniforms.scale.value=5;new THREE.ShaderPass(THREE.RGBShiftShader).uniforms.amount.value=.0045;const d={shape:1,radius:4,rotateR:Math.PI/12,rotateB:Math.PI/12*2,rotateG:Math.PI/12*3,scatter:0,blending:.25,blendingMode:1,greyscale:!1,disable:!1},l=new THREE.HalftonePass(960,720,d);c.addPass(l);const m=new THREE.PlaneGeometry(50,50),u=new THREE.MeshPhongMaterial({color:1118481}),p=new THREE.Mesh(m,u);p.position.set(0,0,-2),o.add(p);const h=new THREE.LoadingManager,w=new THREE.GLTFLoader(h).setPath("./public/models/");let f={cat:{url:"cat2.glb",index:1},dog:{url:"dog2.glb",index:2},tv:{url:"tv2.glb",index:0}};for(const t in f){const e=f[t];w.load(e.url,(t=>{e.model=t.scene,o.add(e.model),e.mixer=new THREE.AnimationMixer(e.model);const n=t.animations,a=THREE.AnimationClip.findByName(n,"Talking");e.mixer.clipAction(a).play()}))}const g={};w.load("letters.glb",(t=>{t.scene.children.forEach((t=>{g[t.name]=t}))})),h.onLoad=()=>{console.log("models loaded")};let E=[],C=[];const v=new THREE.Group;function T(t){let e=Cool.choice([!0,!1]),n=e?Cool.random(1e-4,.01):0,o=e?Cool.random(1e-4,.01):0,a=e?Cool.random(1e-4,.01):0,s=Cool.choice([!0,!1]),i=Cool.randomInt(50,100),r=0,c=Cool.choice(["x","y","z"]),d=Cool.random(-.01,.01);return{update(){e&&(t.rotation.x+=n,t.rotation.y+=o,t.rotation.z+=a),s&&(r<i?r++:t.position[c]+=d)}}}function y(){E=[];for(let t=v.children.length-1;t>=0;t--)o.remove(v.children[t]),v.remove(v.children[t]);Object.keys(g);const t=Cool.shuffle([0,1,2,3,4,5,6,7,8]),e=[4,3],n=function(){let t=new THREE.Color;return t.setRGB(Cool.random(.5,.7),Cool.random(.7,.8),Cool.random(.7,.9)),new THREE.MeshStandardMaterial({color:t.getHex()})}();for(let o=0;o<3;o++)for(let a=0;a<3;a++){const s=o*e[0]-e[0],i=a*e[1]-e[1];let r=!1;for(const e in f){const{index:c,model:d}=f[e];t[c]===o+3*a&&(d.position.set(s,i,0),d.rotation.set(0,0,0),d.traverse((t=>{t.material&&(t.material=n)})),E.push(T(d)),r=!0)}if(r)continue;const c=Cool.choice(Object.keys(g)),d=g[c].clone();d.material=n,d.position.set(s,i,0),v.add(d),E.push(T(d))}}o.add(v);const x=new THREE.Clock;let k;function R(){if(t){requestAnimationFrame(R),k=x.getDelta();for(let t=0,e=E.length;t<e;t++)E[t].update();for(let t=0,e=C.length;t<e;t++)C[t].update();for(const t in f)f[t].mixer.update(k);c.render()}}return{start(){t=!0,y(),R(),e.classList.add("active")},stop(){t=!1,e.classList.remove("active")},isActive:()=>t}}(),E={},C=!1;function v(t,e,n){if(n&&s.scenes.currentName===t){("cat"===t?u:p).animation.state=Cool.randomInt(0,5)}else{if("cat"===t){const t=e?"cat":Cool.choice(["cat","dog"]);s.scenes.current=t,"cat"===t&&(u.animation.state=e?Cool.randomInt(6,10):Cool.randomInt(0,5)),"dog"===t&&(p.animation.state=Cool.randomInt(0,5))}if("dog"===t){const t=e?"dog":Cool.choice(["cat","dog"]);s.scenes.current=t,"cat"===t&&(u.animation.state=Cool.randomInt(0,5)),"dog"===t&&(p.animation.state=e?Cool.randomInt(6,10):Cool.randomInt(0,5))}"tv"===t&&(s.scenes.current="tv",h.animation.state=Cool.randomInt(0,h.animation.endFrame)),"main"===t&&(s.scenes.current="main",i.state=Cool.randomInt(0,i.animation.endFrame),r.state=Cool.randomInt(0,i.animation.endFrame),c.state=Cool.randomInt(0,i.animation.endFrame))}}document.addEventListener("keydown",(t=>{80===t.which&&(console.log("pause"),C=!C,console.log(C)),"s"===Cool.keys[t.which]&&g.start()})),s.start=function(){const{sprites:e}=s.anims,g=new a({x:200,y:200,msg:"loading",letters:e.dog_letters,track:24,countForward:!0,countBackward:!0,repeatCount:!0,delay:60});s.scenes.loading.addToDisplay(g);const C=new o({x:100,y:100,msg:"Click to start with sound",wrap:26,letters:e.cat_letters,track:22,countForward:!0});s.scenes.start.addUI(C),C.onClick=function(){s.scenes.current="main",f=!0,async function(){const t=await fetch("./doodoo/compositions/tv1_theme.json").then((t=>t.json())),e=await fetch("./doodoo/compositions/tv1_tv.json").then((t=>t.json()));E.main=new Doodoo({...t,samplesURL:"./doodoo/samples/",volume:-20,autoStart:!1}),E.tv=new Doodoo({...e,autoStart:!1,samplesURL:"./doodoo/samples/",volume:-6}),E.main.play()}(),w.setupVoice(),w.start()};const T=new o({x:100,y:200,msg:"Click to start without sound",wrap:29,letters:e.cat_letters,track:22,countForward:!0});s.scenes.start.addUI(T),T.onClick=function(){s.scenes.current="main",f=!1,w.start()};const y=new n;y.addAnimation(e.tv_frame),s.scenes.addToDisplay(y,["loading","start","main","cat","dog","tv"]),i=new n(500,-20),i.addAnimation(e.cat_main),s.scenes.main.addToDisplay(i),r=new n(-20,100),r.addAnimation(e.dog_main),s.scenes.main.addToDisplay(r),c=new n(260,265),c.addAnimation(e.tv_main),s.scenes.main.addToDisplay(c),u=new n(650,320),u.center=!0,u.addAnimation(e.cat_close),s.scenes.cat.addToDisplay(u),d=new a({x:100,y:100,letters:e.cat_letters,wrap:12,track:22,lead:60,countForward:!0,countBackward:!0,endDelay:20}),l=new a({x:500,y:200,letters:e.dog_letters,wrap:12,track:24,lead:60,countForward:!0,countBackward:!0,endDelay:20}),p=new n(250,350),p.center=!0,p.addAnimation(e.dog_close),s.scenes.dog.addToDisplay(p),h=new n(s.halfWidth,s.halfHeight),h.center=!0,h.addAnimation(e.tv_close),s.scenes.tv.addToDisplay(h),[i,r,c,u,p,h].forEach((t=>{for(let e=0;e<=t.animation.endFrame;e++)t.animation.createNewState(""+e,e,e);t.animation.state=Cool.randomInt(0,t.animation.endFrame)})),w=t(d,l,v),m={cat:u,dog:p},s.scenes.current="start"},s.draw=function(t){if(!g.isActive()&&(s.scenes.current.display(),!C&&w.isActive())){if(!0===w.update(t)){v("tv"),g.start(),E.main.stop(),E.tv.play();let t=0,e=Cool.randomInt(3,6),n=Cool.randomInt(400,2e3),o=setInterval((()=>{t<=e?(g.start(),t++):(g.stop(),E.tv.stop(),E.main.play(),v("main"),setInterval((()=>{w.start()}),300),clearInterval(o))}),n)}}},s.mouseDown=function(t,e){s.scenes.current.mouseDown(t,e)},s.mouseUp=function(t,e){s.scenes.current.mouseUp(t,e)},s.mouseMoved=function(t,e){s.scenes.current.mouseMoved(t,e)}}();
//# sourceMappingURL=src_maps/tv.min.js.map
