!function(){"use strict";function e(e,t,n){const o=[];let a,s,i,c=0,r=2,d=!1,l="start",m={cat:e,dog:t};p();let u=new CFGGenerator({tagChance:1,filterChance:1});function h(e,t){return Cool.randomInt(e||1,t||3)}function p(){l="start";const[e,t]=Cool.shuffle(["cat","dog"]);a=m[e],o.push({speaker:e,text:"I'm hungry.",delay:h()}),o.push({speaker:t,text:"Me too.",delay:h()}),o.push({speaker:e,text:"When will we eat again?",delay:h()}),o.push({speaker:t,text:"I don't know.",delay:h()}),o.push({speaker:e,text:"Should we watch some tv?",delay:h()})}return async function(){const e=await fetch("./text_tools/data/FEAR_AND_TREMBLING-cfg.json").then((e=>e.json()));u.feed("cat",e),u.feed("dog",e)}(),{update:function(e){if(c<=r)return c+=e/1e3;if(!s&&0===o.length){if("start"===l)return s=!1,function(){l="new";const[e,t]=Cool.shuffle(["cat","dog"]);a=m[e],o.push({speaker:e,text:"What was the point of that?",delay:h()}),o.push({speaker:t,text:u.getText(t,"C",{C:[["I think it was about","DT","NN","of","NN","."]]}).text,delay:h()}),o.push({speaker:e,text:u.getText(e,"C",{C:[["You don't think it was","Q"]]}).text,delay:h()}),o.push({speaker:t,text:u.getText(t,"C",{C:[["I guess it might have been","S"]]}).text,delay:h()}),o.push({speaker:e,text:u.getText(e,"C",{C:[["I don't think we really know what it was about."]]}).text,delay:h()})}(),d=!1,!0;"new"===l&&(s=!1,p())}if(!s){const e=o.shift();i=e.delay,s=e.speaker,a=m[e.speaker],a.isActive=!0,a.setMsg(e.text),n(s,!0)}const t=a.display();if(!t)return!1;t&&(r=i,c=0,a.isActive=!1,n(Cool.random(["cat","dog","tv","main"]),!1),s=!1)},isActive:()=>d,start(){d=!0}}}const{Game:t,Sprite:n,TextButton:o,TextSprite:a}=LinesEngine,s=new t({dps:20,width:960,height:720,retina:!0,debug:!0,stats:!0,suspend:!1,scenes:["main","cat","dog","tv","start"],lineWidth:1,events:["mouse"]});let i,c,r,d,l,m,u,h,p,w;s.load({sprites:"public/sprites.json"});let f=!1,g=function(){let e=!1;const t=document.getElementById("three"),n=new THREE.WebGLRenderer({canvas:t,antialias:!0});n.setSize(960,720),document.body.appendChild(n.domElement);const o=new THREE.Scene,a=new THREE.PerspectiveCamera(75,960/720,.1,1e3);a.position.z=7;const s=new THREE.AmbientLight({color:1118481});o.add(s);const i=new THREE.PointLight(16777215,1);i.position.set(0,0,-10),o.add(i);const c=new THREE.PointLight(16777215,1);c.position.set(0,0,10),o.add(c);const r=new THREE.EffectComposer(n);r.addPass(new THREE.RenderPass(o,a));new THREE.ShaderPass(THREE.DotScreenShader).uniforms.scale.value=5;new THREE.ShaderPass(THREE.RGBShiftShader).uniforms.amount.value=.0045;const d={shape:1,radius:4,rotateR:Math.PI/12,rotateB:Math.PI/12*2,rotateG:Math.PI/12*3,scatter:0,blending:.25,blendingMode:1,greyscale:!1,disable:!1},l=new THREE.HalftonePass(960,720,d);r.addPass(l);const m=new THREE.PlaneGeometry(50,50),u=new THREE.MeshPhongMaterial({color:1118481}),h=new THREE.Mesh(m,u);h.position.set(0,0,-2),o.add(h);const p=new THREE.LoadingManager,w=new THREE.GLTFLoader(p).setPath("./public/models/");let f,g;w.load("cat2.glb",(e=>{f=e.scene,o.add(f),g=new THREE.AnimationMixer(f);const t=e.animations,n=THREE.AnimationClip.findByName(t,"Talking");g.clipAction(n).play()}));const E={};w.load("letters.glb",(e=>{e.scene.children.forEach((e=>{E[e.name]=e}))})),p.onLoad=()=>{console.log("models loaded"),function(){const e=Object.keys(E),t=Cool.shuffle([0,1,2,3,4,5,6,7,8]),n=[4,3],a=k();for(let e=0;e<3;e++)for(let s=0;s<3;s++){const i=e*n[0]-n[0],c=s*n[1]-n[1];if(t[0]===e+3*s){f.position.set(i,c,0),f.traverse((e=>{e.material&&(e.material=a)}));continue}if(Cool.chance(.1))continue;const r=Cool.choice(Object.keys(E)),d=E[r].clone();d.material=a,d.position.set(i,c,0),o.add(d),C.push(y(d))}Cool.choice(e),k();for(let e=-5;e<=5;e+=2);}()};let C=[],T=[];function y(e){let t=Cool.choice([!0,!1]),n=t?Cool.random(1e-4,.01):0,o=t?Cool.random(1e-4,.01):0,a=t?Cool.random(1e-4,.01):0,s=Cool.choice([!0,!1]),i=Cool.randomInt(50,100),c=0,r=Cool.choice(["x","y","z"]),d=Cool.random(-.01,.01);return{update(){t&&(e.rotation.x+=n,e.rotation.y+=o,e.rotation.z+=a),s&&(c<i?c++:e.position[r]+=d)}}}function k(){let e=new THREE.Color;return e.setHex(14474460*Math.random()),new THREE.MeshStandardMaterial({color:e.getHex()})}const x=new THREE.Clock;function v(){if(e){requestAnimationFrame(v);for(let e=0,t=C.length;e<t;e++)C[e].update();for(let e=0,t=T.length;e<t;e++)T[e].update();g.update(x.getDelta()),r.render()}}return{start(){e=!0,v(),t.classList.add("active")},stop(){e=!1,t.classList.remove("active")},isActive:()=>e}}(),E=!1;function C(e,t,n){if(n&&s.scenes.currentName===e){console.log("endDialog");("cat"===e?u:h).animation.state=Cool.randomInt(0,5)}else{if("cat"===e){const e=t?"cat":Cool.choice(["cat","dog"]);s.scenes.current=e,"cat"===e&&(u.animation.state=t?Cool.randomInt(6,10):Cool.randomInt(0,5)),"dog"===e&&(h.animation.state=Cool.randomInt(0,5))}if("dog"===e){const e=t?"dog":Cool.choice(["cat","dog"]);s.scenes.current=e,"cat"===e&&(u.animation.state=Cool.randomInt(0,5)),"dog"===e&&(h.animation.state=t?Cool.randomInt(6,10):Cool.randomInt(0,5))}"tv"===e&&(s.scenes.current="tv",p.animation.state=Cool.randomInt(0,p.animation.endFrame)),"main"===e&&(s.scenes.current="main",i.state=Cool.randomInt(0,i.animation.endFrame),c.state=Cool.randomInt(0,i.animation.endFrame),r.state=Cool.randomInt(0,i.animation.endFrame))}}document.addEventListener("keydown",(e=>{80===e.which&&(console.log("pause"),E=!E,console.log(E))})),s.start=function(){const{sprites:t}=s.anims,E=new o({x:100,y:100,msg:"Click to start with sound",wrap:26,letters:t.cat_letters,track:22,countForward:!0});s.scenes.start.addUI(E),E.onClick=function(){s.scenes.current="main",f=!0,w.start()};const T=new o({x:100,y:200,msg:"Click to start without sound",wrap:29,letters:t.cat_letters,track:22,countForward:!0});s.scenes.start.addUI(T),T.onClick=function(){s.scenes.current="main",f=!1,w.start()};const y=new n;y.addAnimation(t.tv_frame),s.scenes.addToDisplay(y,["start","main","cat","dog","tv"]),i=new n(500,-20),i.addAnimation(t.cat_main),s.scenes.main.addToDisplay(i),c=new n(-20,100),c.addAnimation(t.dog_main),s.scenes.main.addToDisplay(c),r=new n(260,265),r.addAnimation(t.tv_main),s.scenes.main.addToDisplay(r),u=new n(650,320),u.center=!0,u.addAnimation(t.cat_close),s.scenes.cat.addToDisplay(u),d=new a({x:100,y:100,letters:t.cat_letters,wrap:12,track:22,lead:60,countForward:!0,countBackward:!0,endDelay:20}),l=new a({x:500,y:200,letters:t.dog_letters,wrap:12,track:24,lead:60,countForward:!0,countBackward:!0,endDelay:20}),h=new n(250,350),h.center=!0,h.addAnimation(t.dog_close),s.scenes.dog.addToDisplay(h),p=new n(s.halfWidth,s.halfHeight),p.center=!0,p.addAnimation(t.tv_close),s.scenes.tv.addToDisplay(p),[i,c,r,u,h,p].forEach((e=>{for(let t=0;t<=e.animation.endFrame;t++)e.animation.createNewState(""+t,t,t);e.animation.state=Cool.randomInt(0,e.animation.endFrame)})),w=e(d,l,C),m={cat:u,dog:h},s.scenes.current="start",console.log("lines",s),g.start()},s.draw=function(e){if(!g.isActive()&&(s.scenes.current.display(),!E&&w.isActive())){!0===w.update(e)&&(C("tv"),g.start(),setTimeout((()=>{console.log("back"),g.stop(),C("main"),w.start()}),1e4))}},s.mouseDown=function(e,t){s.scenes.current.mouseDown(e,t)},s.mouseUp=function(e,t){s.scenes.current.mouseUp(e,t)},s.mouseMoved=function(e,t){s.scenes.current.mouseMoved(e,t)}}();
//# sourceMappingURL=src_maps/tv.min.js.map
