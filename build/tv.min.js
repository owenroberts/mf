!function(){"use strict";function e(e,t,n){const o=[];let a,s,i,c=0,r=2,d=!1,l="start",m={cat:e,dog:t};const u={};let p,h,f=new CFGGenerator({tagChance:1,filterChance:1});function w(e){l=e;const[t,n]=Cool.shuffle(["cat","dog"]);a=m[t];let s=Cool.choice(h[e]);for(let e=0;e<s.length;e++){let a=e%2==0?t:n,i=f.getSentence(a,s[e],!0);o.push({text:i,speaker:a})}}return async function(){const e=await fetch("./public/grammars/CODEX-cfg.json").then((e=>e.json())),t=await fetch("./public/grammars/The_Mystery_of_the_Apocalypse-cfg.json").then((e=>e.json()));h=await fetch("./public/grammars/cycle.json").then((e=>e.json())),f.feed("cat",t),f.feed("cat",h,!1),f.feed("dog",e),f.feed("dog",h,!1),w("A")}(),{update:function(e){if(c<=r)return c+=e/1e3;if(!s&&0===o.length){if("A"===l)return s=!1,w("B"),d=!1,!0;"B"===l&&(s=!1,w("A"))}if(!s){const e=o.shift();if(i=Cool.randomInt(t||1,h||2),s=e.speaker,a=m[e.speaker],a.isActive=!0,a.setMsg(e.text),n(s,!0),p&&u[e.speaker]){const t=new SpeechSynthesisUtterance(e.text);t.rate=.75,t.voice=u[e.speaker],p.speak(t)}}var t,h;const f=a.display();if(!f)return!1;f&&(r=i,c=0,a.isActive=!1,n(Cool.random(["cat","dog","tv","main"]),!1),s=!1)},setupVoice:function(){if(!window.speechSynthesis)return;p=window.speechSynthesis;let e=setInterval((()=>{p.getVoices()&&(!function(){const e=p.getVoices(),t=e.find((e=>"Fred"===e.name)),n=e.find((e=>"Victoria"===e.name));u.cat=n||e[1],u.dog=t||e[0]}(),clearInterval(e))}),60)},isActive:()=>d,start(){d=!0}}}const{Game:t,Sprite:n,TextButton:o,TextSprite:a}=LinesEngine,s=new t({dps:20,width:960,height:720,retina:!0,suspend:!1,scenes:["loading","main","cat","dog","tv","start"],lineWidth:1,events:["mouse"]});let i,c,r,d,l,m,u,p,h,f,w,g,E=!1,C=function(){let e=!1;const t=document.getElementById("three"),n=new THREE.WebGLRenderer({canvas:t,antialias:!0});n.setSize(960,720),document.body.appendChild(n.domElement);const o=new THREE.Scene,a=new THREE.PerspectiveCamera(75,960/720,.1,1e3);a.position.z=7;const s=new THREE.AmbientLight(3026478,1);o.add(s);const i=new THREE.PointLight(16777215,1);i.position.set(0,0,-10),o.add(i);const c=new THREE.PointLight(16777215,.75);c.position.set(0,0,10),o.add(c);const r=new THREE.EffectComposer(n);r.addPass(new THREE.RenderPass(o,a));new THREE.ShaderPass(THREE.DotScreenShader).uniforms.scale.value=5;new THREE.ShaderPass(THREE.RGBShiftShader).uniforms.amount.value=.0045;const d={shape:1,radius:4,rotateR:Math.PI/12,rotateB:Math.PI/12*2,rotateG:Math.PI/12*3,scatter:0,blending:.25,blendingMode:1,greyscale:!1,disable:!1},l=new THREE.HalftonePass(960,720,d);r.addPass(l);const m=new THREE.PlaneGeometry(50,50),u=new THREE.MeshPhongMaterial({color:1118481}),p=new THREE.Mesh(m,u);p.position.set(0,0,-4),o.add(p);const h=new THREE.LoadingManager,f=new THREE.GLTFLoader(h).setPath("./public/models/");let w={cat:{url:"cat2.glb",index:1},dog:{url:"dog2.glb",index:2},tv:{url:"tv2.glb",index:0}};for(const e in w){const t=w[e];f.load(t.url,(e=>{t.model=e.scene,o.add(t.model),t.mixer=new THREE.AnimationMixer(t.model);const n=e.animations,a=THREE.AnimationClip.findByName(n,"Talking");t.mixer.clipAction(a).play()}))}const g={};f.load("letters.glb",(e=>{e.scene.children.forEach((e=>{g[e.name]=e}))})),h.onLoad=()=>{console.log("models loaded")};let E=[],C=[];const v=new THREE.Group;function y(e,t){let n=Cool.choice([!0,!1]),o=n?Cool.random(1e-4,.01):0,a=n?Cool.random(1e-4,.01):0,s=n?Cool.random(1e-4,.01):0,i=Cool.choice([!0,!1]),c=Cool.randomInt(50,100),r=0,d=Cool.choice(["x","y","z"]),l=Cool.random(-.01,.01);if(!i&&!n&&t){let n=e.clone(),o=e.clone();n.position.x-=1,o.position.x+=1;let a=Cool.random(2*Math.PI);e.rotation.z=a,n.rotation.z=a,o.rotation.z=a,t.add(n),t.add(o)}return{update(){n&&(e.rotation.x+=o,e.rotation.y+=a,e.rotation.z+=s),i&&(r<c?r++:e.position[d]+=l)}}}function T(){E=[];for(let e=v.children.length-1;e>=0;e--)o.remove(v.children[e]),v.remove(v.children[e]);Object.keys(g);const e=Cool.shuffle([0,1,2,3,4,5,6,7,8]);let t=Cool.randomInt(2,4),n=Cool.randomInt(2,4),a=10/t,s=8/n;Cool.randomInt(1,3);const i=function(){let e=new THREE.Color;return e.setRGB(Cool.random(.5,.7),Cool.random(.7,.8),Cool.random(.7,.9)),new THREE.MeshStandardMaterial({color:e.getHex()})}();for(let o=0;o<=t;o++)for(let t=0;t<=n;t++){const n=o*a-5,c=t*s-4,r=0;let d=!1;for(const a in w){const{index:s,model:l}=w[a];e[s]===o+3*t&&(l.position.set(n,c,r),l.rotation.set(0,0,0),l.traverse((e=>{e.material&&(e.material=i)})),E.push(y(l)),d=!0)}if(d)continue;const l=Cool.choice(Object.keys(g)),m=g[l].clone();m.material=i,m.position.set(n,c,r),v.add(m),E.push(y(m,v))}}o.add(v);const I=new THREE.Clock;let R;function H(){if(e){requestAnimationFrame(H),R=I.getDelta();for(let e=0,t=E.length;e<t;e++)E[e].update();for(let e=0,t=C.length;e<t;e++)C[e].update();for(const e in w)w[e].mixer.update(R);r.render()}}return{start(){e=!0,T(),H(),t.classList.add("active")},stop(){e=!1,t.classList.remove("active")},isActive:()=>e}}(),v={},y=!1;function T(e,t,n){if(n&&s.scenes.currentName===e){("cat"===e?u:p).animation.state=Cool.randomInt(0,5)}else{if("cat"===e){const e=t?"cat":Cool.choice(["cat","dog"]);s.scenes.current=e,"cat"===e&&(u.animation.state=t?Cool.randomInt(6,10):Cool.randomInt(0,5)),"dog"===e&&(p.animation.state=Cool.randomInt(0,5))}if("dog"===e){const e=t?"dog":Cool.choice(["cat","dog"]);s.scenes.current=e,"cat"===e&&(u.animation.state=Cool.randomInt(0,5)),"dog"===e&&(p.animation.state=t?Cool.randomInt(6,10):Cool.randomInt(0,5))}"tv"===e&&(s.scenes.current="tv",h.animation.state=Cool.randomInt(0,h.animation.endFrame)),"main"===e&&(s.scenes.current="main",i.state=Cool.randomInt(0,i.animation.endFrame),c.state=Cool.randomInt(0,i.animation.endFrame),r.state=Cool.randomInt(0,i.animation.endFrame))}}document.addEventListener("keydown",(e=>{80===e.which&&(console.log("pause"),y=!y,console.log(y)),"s"===Cool.keys[e.which]&&C.start()})),async function(){w=await fetch("./public/compositions/tv1_theme.json").then((e=>e.json())),g=await fetch("./public/compositions/tv1_tv.json").then((e=>e.json())),s.load({sprites:"public/sprites.json"})}(),s.start=function(){const{sprites:t}=s.anims,C=new a({x:200,y:200,msg:"loading",letters:t.dog_letters,track:24,countForward:!0,countBackward:!0,repeatCount:!0,delay:60});s.scenes.loading.addToDisplay(C);const y=new n(s.halfWidth,300);y.center=!0,y.addAnimation(t.title),s.scenes.start.addToDisplay(y);const I=new o({x:s.halfWidth,y:420,center:!0,msg:"Click to start with sound",wrap:26,letters:t.cat_letters,track:22,countForward:!0});s.scenes.start.addUI(I),I.onClick=function(){s.scenes.current="main",E=!0,v.main=new Doodoo({...w,samplesURL:"./doodoo/samples/",volume:-20,autoStart:!1}),v.tv=new Doodoo({...g,autoStart:!1,samplesURL:"./doodoo/samples/",volume:-6}),v.main.play(),f.setupVoice(),f.start()};const R=new o({x:s.halfWidth,y:500,center:!0,msg:"Click to start without sound",wrap:29,letters:t.cat_letters,track:22,countForward:!0});s.scenes.start.addUI(R),R.onClick=function(){s.scenes.current="main",E=!1,f.start()};const H=new n;H.addAnimation(t.tv_frame),s.scenes.addToDisplay(H,["loading","start","main","cat","dog","tv"]),i=new n(500,-20),i.addAnimation(t.cat_main),s.scenes.main.addToDisplay(i),c=new n(-20,100),c.addAnimation(t.dog_main),s.scenes.main.addToDisplay(c),r=new n(260,265),r.addAnimation(t.tv_main),s.scenes.main.addToDisplay(r),u=new n(650,320),u.center=!0,u.addAnimation(t.cat_close),s.scenes.cat.addToDisplay(u),d=new a({x:100,y:100,letters:t.cat_letters,wrap:12,track:22,lead:60,countForward:!0,countBackward:!0,endDelay:20}),l=new a({x:500,y:200,letters:t.dog_letters,wrap:12,track:24,lead:60,countForward:!0,countBackward:!0,endDelay:20}),p=new n(250,350),p.center=!0,p.addAnimation(t.dog_close),s.scenes.dog.addToDisplay(p),h=new n(s.halfWidth,s.halfHeight),h.center=!0,h.addAnimation(t.tv_close),s.scenes.tv.addToDisplay(h),[i,c,r,u,p,h].forEach((e=>{for(let t=0;t<=e.animation.endFrame;t++)e.animation.createNewState(""+t,t,t);e.animation.state=Cool.randomInt(0,e.animation.endFrame)})),f=e(d,l,T),m={cat:u,dog:p},s.scenes.current="start"},s.draw=function(e){if(!C.isActive()&&(s.scenes.current.display(),!y&&f.isActive())){if(!0===f.update(e)){T("tv"),C.start(),E&&v.main.stop(),E&&v.tv.play();let e=0,t=Cool.randomInt(5,8),n=Cool.randomInt(500,3e3),o=setInterval((()=>{e<=t?(C.start(),e++):(C.stop(),E&&v.tv.stop(),E&&v.main.play(),T("main"),setInterval((()=>{f.start()}),300),clearInterval(o))}),n)}}},s.mouseDown=function(e,t){s.scenes.current.mouseDown(e,t)},s.mouseUp=function(e,t){s.scenes.current.mouseUp(e,t)},s.mouseMoved=function(e,t){s.scenes.current.mouseMoved(e,t)}}();
//# sourceMappingURL=src_maps/tv.min.js.map
